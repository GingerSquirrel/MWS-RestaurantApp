let restaurants,neighborhoods,cuisines;var map,markers=[];document.addEventListener('DOMContentLoaded',()=>{DBHelper.serviceWorker(),fetchNeighborhoods(),fetchCuisines(),updateRestaurants()}),fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((a,b)=>{a?console.error(a):(self.neighborhoods=b,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=(a=self.neighborhoods)=>{const b=document.getElementById('neighborhoods-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},fetchCuisines=()=>{DBHelper.fetchCuisines((a,b)=>{a?console.error(a):(self.cuisines=b,fillCuisinesHTML())})},fillCuisinesHTML=(a=self.cuisines)=>{const b=document.getElementById('cuisines-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},setMapTitle=()=>{const a=document.querySelector('#map').querySelector('iframe');a.setAttribute('title','Google map showing the locations of all the restaurants')},window.initMap=()=>{self.map=new google.maps.Map(document.getElementById('map'),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),self.map.addListener('tilesloaded',setMapTitle)},updateRestaurants=()=>{const a=document.getElementById('cuisines-select'),b=document.getElementById('neighborhoods-select'),c=a.selectedIndex,d=b.selectedIndex,e=a[c].value,f=b[d].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(e,f,(g,h)=>{g?console.error(g):(resetRestaurants(h),fillRestaurantsHTML(),loadStaticMap())})},resetRestaurants=a=>{self.restaurants=[];const b=document.getElementById('restaurants-list');b.innerHTML='',self.markers.forEach(c=>c.setMap(null)),self.markers=[],self.restaurants=a},fillRestaurantsHTML=(a=self.restaurants)=>{const b=document.getElementById('restaurants-list');a.forEach(c=>{b.append(createRestaurantHTML(c))})},createRestaurantHTML=a=>{const b=document.createElement('li');b.setAttribute('aria-label',a.name);const c=document.createElement('img');c.className='lozad restaurant-img',c.src=DBHelper.imageUrlForRestaurant(a),c.alt=c.src.endsWith('/img/0.webp')?'Awaiting photograph of restaurant':'A photograph of the Restaurant',b.append(c);const d=document.createElement('h2');d.innerHTML=a.name,b.append(d);const e=document.createElement('p');e.innerHTML=a.neighborhood,b.append(e);const f=document.createElement('p');f.innerHTML=a.address,b.append(f);const g=document.createElement('a');return g.innerHTML='View Details',g.setAttribute('aria-label','View more details of'+a.name),g.href=DBHelper.urlForRestaurant(a),b.append(g),b},addMarkersToMap=(a=self.restaurants)=>{a.forEach(b=>{const c=DBHelper.mapMarkerForRestaurant(b,self.map);google.maps.event.addListener(c,'click',()=>{window.location.href=c.url}),self.markers.push(c)})},loadMap=()=>{console.log('map load function run');var a=document.createElement('div');a.id='map',document.getElementById('map-container').appendChild(a),initMap(),addMarkersToMap()},loadStaticMap=(a=self.restaurants)=>{var b=document.getElementById('map-container');b.setAttribute('onclick','loadMap();');var c='https://maps.googleapis.com/maps/api/staticmap?&zoom=11&size=600x300&maptype=roadmap';a.forEach(d=>{c+=`&markers=color:red%7C${d.latlng.lat},${d.latlng.lng}`}),c+='&key=AIzaSyC89Xoq-j_tvlTwr_T6772k0DvAi0aEvpI',b.setAttribute('style','background-image:url('+c+'); background-size: cover; background-position:center;')};
